<!-- wp:html -->
  
<p>Quelle proportion des français a été vaccinée ? Combien faut-il encore vacciner de personnes avant d'atteindre l'immunité collective ? Quels sont les différents types de vaccins proposés ?
Ce tracker permet de suivre la proportion de français déjà vaccinés contre la Covid19, et le nombre de personnes restant à vacciner pour atteindre l'immunité collective.
</p>

<div class="alert alert-warning" role="alert">
    <i>03 janvier à 10h</i><br>Contacté par CovidTracker, le Ministère de la Santé a indiqué ne pas disposer à ce jour des données consolidées à partir du 31 décembre.
    ⚠️ Les données affichées pour le 31/12 et les jours suivants sont partielles, issues d'une estimation CovidTracker. Elles seront réévaluées dans les prochains jours.
</div>
<div class="row" style="margin-left: 2px;">
    Bonne année 2021 ! CovidTracker est gratuit, sans pub et développé bénévolement.<br>
    <button class="btn-shadow"><a href="https://lydia-app.com/collect/covidtracker/fr" target="_blank" rel="noreferrer noopener">🥂 Offrez-moi une coupe de champagne</a></button> &nbsp;&nbsp;
</div>
<!-- /wp:html -->

<!-- wp:html -->
<div class="wrap">
    <div class="one">
        <h2 id="nb_vaccines">--</h2>
        <b>Personnes vaccinées</b><br>
        Nombre cumulé de personnes ayant reçu au moins une dose de vaccin contre la Covid19 en France (soit <span id="proportionVaccinesBox">--</span>%).<br>
        <i>Données incomplètes à partir du 31/12.</i>
        <span style="font-size: 70%;"><i>Mise à jour : <span id="date_maj_2">--/--</span>. Données : CovidTracker/Ministère de la Santé.</i></span>
    </div>

    <div class="two">
        <h2 id="nb_vaccines_24h">--</h2>
        <b>Doses injectées en 24h</b><br>
        Nombre de personnes ayant reçu au moins une dose de vaccin contre la Covid19 en France ces dernières 24h<br>
        <span style="font-size: 70%;"><i>Mise à jour : <span id="date_maj_1">--/--</span>. Données : CovidTracker/Ministère de la Santé.</i></span>
    </div>
</div>

<h2 style="margin-top : 80px;">Proportion de personnes vaccinées</h2>
Chaque carré correspond à 1% des français. Les carrés verts <svg width="10" height="10"><rect x="0" y="0" width="60" height="60" style="fill:rgb(45, 189, 84);" /></svg> correspondent aux français ayant reçu au moins une dose de vaccin (deux sont nécessaires). Les carrés rouge vif <svg width="10" height="10"><rect x="0" y="0" width="60" height="60" style="fill:rgb(237, 88, 88);" /></svg> représentent les français qu'il faut vacciner avant d'atteindre le taux d'immunité collective (environ 60%). 
Les carrés rouge clair <svg width="10" height="10"><rect x="0" y="0" width="60" height="60" style="fill: rgb(207, 169, 169);" /></svg>  représentent les autres français non vaccinés. <i>Mise à jour : <span id="date_maj_3">--/--</span></i>

<div class="row">
    <div class="col-md-4" style="padding-top: 20px;">
        <div style="width: 300px; height: 300px;">
            <table style="width:100%; height:100%" id="tableauVaccin"></table>
        </div>
    </div>
    <br>
    <div class="col-md-4" style="padding-top: 20px;">
        
        <span style="font-size: 200%; color: rgb(45, 189, 84)"><span id="proportionVaccines">--</span>%</span><br> des français ont reçu au moins une dose de vaccin. <br><br> 
        Il reste à vacciner au moins <br><span style="font-size: 200%; color: rgb(237, 88, 88);"><span id="proportionAVaccinerImmu">--</span>%</span><br>des français avant d'atteindre un taux de vaccination de 60% (immunité collective). <br>
    </div>
</div>
<br>

<div class="alert-data" style="margin-top: 15px;">
    <span style="font-size: 80%;">
        <b>Source des données</b> : CovidTracker / Ministère de la Santé.</a>
    </span>
</div>

<h2 style="margin-top : 80px;">Évolution</h2>
<p>
L'objectif est de vacciner 1 million de personnes en janvier 2021. Pour atteindre cet objectif, il faudrait vacciner <b><span id="objectif_quotidien">--</span> personnes</b> chaque jour entre aujourd'hui et le 31 janvier 2021.
</p>
<p>
Au rythme actuel <small>(moyenne des 7 derniers jours)</small>, l'objectif du million de personnes vaccinées sera atteint le <b><span id="date_projetee_objectif"></span></b>.
</p>

Le graphique suivant présente le nombre cumulé de personnes ayant reçu au moins 1 dose de vaccin Covid19.
<br>
<br>

<div>
    <canvas id="lineVacChart" style="margin-top:20px; max-height: 700px; max-width: 900px;"></canvas>
</div>

<h2 style="margin-top : 80px;">Autorisation des vaccins</h2>
<div style="border: 0px solid grey; background-color: rgba(128, 128, 128, 0.1); border-radius: 7px; padding: 12px;">
L'Union Européenne a passé des commandes pour 6 vaccins différents. 1 est autorisé, 1 en cours d'autorisation et 4 non terminés. <i>Mise à jour : 28/12.</i><br><br>
<h3 style="margin-top : 10px;">Vaccins autorisés</h3>
<button class="shadow-btn-green"><b>🇺🇸🇩🇪 Pfizer-BioNTech</b><br>Phase 3 terminée<br>Type : ARN messager<br>Prêt : fin 2020<br>Conservation : -70°C<br>Commandes UE : 300M<br>Statut : autorisé</button>

<h3 style="margin-top : 50px;">Vaccins en cours d'autorisation</h3>

<button class="shadow-btn-orange"><b>🇺🇸 Moderna</b><br>Phase 3 terminée<br>Type : ARN messager<br>Prêt : fin 2020<br>Conservation : -20°C (6 mois), +5°C (1 mois)<br>Commandes UE : 80M (+ option 80M)<br>Autorisation : Décision UE le 6 janvier</button>

<h3 style="margin-top : 50px;">Vaccins non terminés</h3>
<button class="shadow-btn"><b>🇬🇧🇸🇪 AstraZeneca/Oxford</b><br>Phase 3/3<br>Type : Vecteur viral<br>Prêt : fin 2020<br>Conservation : +5°C (6 mois)<br>Commandes UE : 300M (+ option 100M)<br>Statut : non autorisé</button>
<button class="shadow-btn"><b>🇺🇸🇧🇪 Johnson&Johnson</b><br>Phase 3/3<br>Type : Vecteur viral<br>Prêt : fin janvier 2021<br>Conservation : +5°C<br>Commandes UE : 200M (+ option 200M)<br>Statut : non autorisé</button>
<button class="shadow-btn"><b>🇩🇪 CureVac</b><br>Phase 2/3<br>Type : ARN messager<br>Prêt : 1er semestre 2021<br>Conservation : -60°C (3 mois), +5°C (3 mois)<br>Commandes UE : 225M (+ option 180M)<br>Statut : non autorisé</button>
<button class="shadow-btn"><b>🇫🇷🇬🇧 Sanofi-GSK</b><br>Phase 2/3<br>Type : Protéines virales<br>Prêt : fin 2021<br>Conservation : +5°C<br>Commandes UE : 300M<br>Statut : non autorisé</button>
</div>
<br>
<h2>Quand est-ce que sera atteinte l'immunité collective ?</h2>
Sur VaccinTracker, le taux de 60% a été choisi comme seuil d'immunité collective. Cependant, on ne peut pas aujourd'hui connaître ce taux précisément. 
La vidéo suivante du média Le Monde explique très bien la problématique à mon sens :
<br><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/bjFtFMilb34" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<br>
<h2 style="margin-top : 80px;">Quand pourrez-vous vous faire vacciner ?</h2>
<h3 style="margin-top : 20px;">Phase 1 (en cours) : janvier et février 2021</h3>
<ul>
    <li>Personnes âgées séjournant dans un établissement collectif (type EHPAD) ;</li>
    <li>Personnel soignant dit "à risque" (plus de 65 ans et/ou avec comorbidité).</li>
</ul>

<h3 style="margin-top : 50px;">Phase 2 : février / mars 2021</h3>
<ul>
    <li>Personnes âgées de plus de 75 ans en priorité ; puis personnes âgées de plus de 65 ans dans un second temps,</li>
    <li>Professionels de santé ou médico-social (âgé de plus de 50 ans et/ou avec comorbidité).</li>
</ul>

<h3 style="margin-top : 50px;">Phase 3 : fin juin / début juillet 2021</h3>
<ul>
    <li>Personnes âgées de plus de 50 ans,</li>
    <li>Personnes travaillant dans un secteur "essentiel" (*),</li>
    <li>Personne vulnérable ou précaire,</li>
    <li>Personne majeure vivant dans un hébergement confiné ou un lieu clos (**).</li>
</ul>
<br>
(*) Les secteurs considérés comme "essentiels" sont les domaines de la sécurité, de l'éducation et de l'alimentaire, indispensables "au fonctionnement du pays en période épidémique", selon le ministère de la Santé.
(**) Le ministère de la Santé ne donne pas plus de précisions concernant "les hébergements confinés ou les lieux clos". Interrogée par franceinfo sur cette question, la DGS donne uniquement pour exemple les "foyers de travailleurs migrants".
<br>
<h2 style="margin-top : 80px;">Vaccination dans le monde</h2>
Ce graphique présente le nombre de doses administrées pour 100 personnes de chaque habitant. Pour la plupart des vaccins, 2 doses sont nécessaires. L'immunité collective serait atteinte à partir d'environ 120 doses pour 100 habitants.
<iframe src="https://ourworldindata.org/grapher/covid-vaccination-doses-per-capita?tab=chart&stackMode=absolute&time=latest&region=World" loading="lazy" style="width: 100%; height: 600px; border: 0px none;"></iframe>
<br>
<br>
Ce graphique présente le nombre de doses administrées dans chaque pays.
<iframe src="https://ourworldindata.org/grapher/cumulative-covid-vaccinations?tab=chart&stackMode=absolute&time=latest&region=World" loading="lazy" style="width: 100%; height: 600px; border: 0px none;"></iframe>
<br>
<br>
Développé bénévolement par <a href="https://twitter.com/guillaumerozier">Guillaume Rozier</a>


<style>
.wrap {
        display: flex;
        margin-top: 0px;
        flex-wrap: wrap;
  }
  .wrap>* {
        flex: 1 1 200px;
    }

    .one {
        border: 0px solid black;
        margin-top: 20px;
        padding: 10px 10px 10px 10px;
        border-radius: 7px;
        margin-right: 15px;
        max-width: 400px;
        text-align: left;
        /*box-shadow: 6px 4px 25px #c3d19d;*/
        box-shadow: 0 0 0 transparent, 0 0 0 transparent, 6px 4px 25px #d6d6d6;
        width: 100%;
        background: #ffffff;
  }

    .two {
        border: 0px solid black;
        margin-top: 20px;
        padding: 10px 10px 10px 10px;
        border-radius: 7px;
        max-width: 400px;
        text-align: left;
        /*  box-shadow: 6px 4px 25px #ffa29c;*/
        box-shadow: 0 0 0 transparent, 0 0 0 transparent, 6px 4px 25px #d6d6d6;
        background: #ffffff;
        width: 100%;
        
  }

p{
    font-size: 120%;
}

.shadow-btn {
        border: 0px solid black;
        padding: 12px;
        font-size: 100%;
        border-radius: 7px;
        margin-right: 5px;
        margin-bottom: 5px;
        margin-top: 2px;
        text-align: left;
        box-shadow: 0 0 0 transparent, 0 0 0 transparent, 6px 4px 25px #d6d6d6;
        max-width: 350px;
        background: #ffffff;
    }

.shadow-btn-green {
    border: 0px solid black;
    padding: 12px;
    font-size: 100%;
    border-radius: 7px;
    margin-right: 5px;
    margin-bottom: 5px;
    margin-top: 2px;
    text-align: left;
    box-shadow: 0 0 0 transparent, 0 0 0 transparent, 6px 4px 25px rgba(0, 128, 0, 0.317);
    max-width: 350px;
    background: #ffffff;
}

.shadow-btn-orange {
    border: 0px solid black;
    padding: 12px;
    font-size: 100%;
    border-radius: 7px;
    margin-right: 5px;
    margin-bottom: 5px;
    margin-top: 2px;
    text-align: left;
    box-shadow: 0 0 0 transparent, 0 0 0 transparent, 6px 4px 25px rgba(128, 115, 0, 0.317);
    max-width: 350px;
    background: #ffffff;
}

.shadow-btn-red {
    border: 0px solid black;
    padding: 12px;
    font-size: 100%;
    border-radius: 7px;
    margin-right: 5px;
    margin-bottom: 5px;
    margin-top: 2px;
    text-align: left;
    box-shadow: 0 0 0 transparent, 0 0 0 transparent, 6px 4px 25px rgba(128, 0, 0, 0.317);
    max-width: 350px;
    background: #ffffff;
}

.shadow {
        border: 0px solid black;
        padding: 12px;
        border-radius: 7px;
        text-align: left;
        box-shadow: 0 0 0 transparent, 0 0 0 transparent, 6px 4px 25px #d6d6d6;
        max-width: 450px;
        background: #ffffff;
        margin-top: 30px;
    }

    .btn-shadow {
        border: 0px solid black;
        padding: 12px;
        border-radius: 7px;
        text-align: left;
        box-shadow: 0 0 0 transparent, 0 0 0 transparent, 6px 4px 25px #d6d6d6;
        max-width: 450px;
        background: #ffffff;
        margin-top: 3px;
    }

table, tr, td {
  border: 1px solid white;
}

body {
    font-size: 16px;
}

td {
    width: 1%;
    height: 1%;
}


.green {
    background-color: rgb(45, 189, 84);
}

.red {
    background-color: rgb(237, 88, 88);
}

.grey {
    background-color: rgb(207, 169, 169);
}

.blink_me {
  animation: blinker 3s ease infinite;
  animation-delay: 2s;
}

@keyframes blinker {
  50% {
    background-color: green;
  }
}

</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/0.5.7/chartjs-plugin-annotation.min.js" integrity="sha512-9hzM/Gfa9KP1hSBlq3/zyNF/dfbcjAYwUTBWYX+xi8fzfAPHL3ILwS1ci0CTVeuXTGkRAWgRMZZwtSNV7P+nfw==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ==" crossorigin="anonymous"></script>

<script>

function numberWithSpaces(x) {
  return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, "&nbsp;");
}
function formaterDate (date) {
  if (!(date instanceof Date)) return String(date);
  return date.toLocaleDateString("fr-FR", { 
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
}


// ref: http://stackoverflow.com/a/1293163/2343
    // This will parse a delimited string into an array of
    // arrays. The default delimiter is the comma, but this
    // can be overriden in the second argument.
    function CSVToArray( strData, strDelimiter ){
        // Check to see if the delimiter is defined. If not,
        // then default to comma.
        strDelimiter = (strDelimiter || ",");

        // Create a regular expression to parse the CSV values.
        var objPattern = new RegExp(
            (
                // Delimiters.
                "(\\" + strDelimiter + "|\\r?\\n|\\r|^)" +

                // Quoted fields.
                "(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|" +

                // Standard fields.
                "([^\"\\" + strDelimiter + "\\r\\n]*))"
            ),
            "gi"
            );


        // Create an array to hold our data. Give the array
        // a default empty first row.
        var arrData = [[]];

        // Create an array to hold our individual pattern
        // matching groups.
        var arrMatches = null;


        // Keep looping over the regular expression matches
        // until we can no longer find a match.
        while (arrMatches = objPattern.exec( strData )){

            // Get the delimiter that was found.
            var strMatchedDelimiter = arrMatches[ 1 ];

            // Check to see if the given delimiter has a length
            // (is not the start of string) and if it matches
            // field delimiter. If id does not, then we know
            // that this delimiter is a row delimiter.
            if (
                strMatchedDelimiter.length &&
                strMatchedDelimiter !== strDelimiter
                ){

                // Since we have reached a new row of data,
                // add an empty row to our data array.
                arrData.push( [] );

            }

            var strMatchedValue;

            // Now that we have our delimiter out of the way,
            // let's check to see which kind of value we
            // captured (quoted or unquoted).
            if (arrMatches[ 2 ]){

                // We found a quoted value. When we capture
                // this value, unescape any double quotes.
                strMatchedValue = arrMatches[ 2 ].replace(
                    new RegExp( "\"\"", "g" ),
                    "\""
                    );

            } else {

                // We found a non-quoted value.
                strMatchedValue = arrMatches[ 3 ];

            }


            // Now that we have our value string, let's add
            // it to the data array.
            arrData[ arrData.length - 1 ].push( strMatchedValue );
        }

        // Return the parsed data.
        return( arrData );
    }

const OBJECTIF_FIN_JANVIER = 1000000 // 1_000_000
var data;
var heures = [];
var dates = [];
var nb_vaccines = [];
var html = ""

var dejaVaccinesNb;
var dejaVaccines;
var restantaVaccinerImmunite;
var restantaVaccinerAutres = 100
var objectifQuotidien;
var dateProjetéeObjectif;

fetch('https://raw.githubusercontent.com/rozierguillaume/vaccintracker/main/data.csv', {cache: 'no-cache'})
       .then(response => {
           if (!response.ok) {
               throw new Error("HTTP error " + response.status);
           }
           return response.text();
       })
       .then(csv => {
          this.data = csv;
          array_data = CSVToArray(csv, ",");
          array_data.slice(1, array_data.length-1).map((value, idx) => {
            dates.push(value[0])
            heures.push(value[2])
            nb_vaccines.push(value[1])
          })

        this.dejaVaccinesNb = nb_vaccines[nb_vaccines.length-1]
        this.dejaVaccines = dejaVaccinesNb*100/67000000;
        this.restantaVaccinerImmunite = 60 - dejaVaccines

        this.objectifQuotidien = calculerObjectif();
        this.dateProjetéeObjectif = calculerDateProjetéeObjectif();
        majValeurs();
        buildLineChart();
        lineChart.annotation.annotations = [
                    {
                    drawTime: "afterDatasetsDraw",
                    id: "hline",
                    type: "line",
                    mode: "horizontal",
                    scaleID: "y-axis-0",
                    value: 3000,
                    borderColor: "green",
                    borderWidth: 3,
                    label: {
                        backgroundColor: "green",
                        content: "Objectif",
                        enabled: true
                    },
                    onClick: function(e) {
                        console.log("Annotation", e.type, this);
                    }
                    }
                ]
        lineChart.update()
        
        
        })
       .catch(function () {
           this.dataError = true;
       }
      )


var lineChart;

function calculerObjectif(){
    
    let one_day = (1000 * 60 * 60 * 24)
    let jours_restant = (Date.parse("2021-01-31") - Date.parse(dates[dates.length-1]) )/ one_day
    let objectif = OBJECTIF_FIN_JANVIER;
    let resteAVacciner = objectif - nb_vaccines[nb_vaccines.length-1]
    console.log(jours_restant)
    if ((resteAVacciner>=0) && (jours_restant>=0)){
        return Math.round(resteAVacciner/jours_restant)
    } else {
        return -1
    }
}
function calculerDateProjetéeObjectif () {
  const objectif = OBJECTIF_FIN_JANVIER
  const indexDernièreMaj = dates.length - 1;
  const indexDébutFenêtre = Math.max(0, indexDernièreMaj - 7)
  const dernièreMaj = Date.parse(dates[indexDernièreMaj])
  const resteAVacciner = objectif - Number(nb_vaccines[indexDernièreMaj])
  const différentielVaccinésFenètre = Number(nb_vaccines[indexDernièreMaj]) - Number(nb_vaccines[indexDébutFenêtre])
  const différentielVaccinésParJour = différentielVaccinésFenètre / (indexDernièreMaj - indexDébutFenêtre)
  const oneDay = (1000 * 60 * 60 * 24)
  const nbJoursAvantObjectif = Math.round(resteAVacciner / différentielVaccinésParJour)
  return new Date(dernièreMaj + (oneDay * nbJoursAvantObjectif))
}

function buildLineChart(projection_cas, labels_cas, projection_rea){
    
    var ctx = document.getElementById('lineVacChart').getContext('2d');

    lineChart = new Chart(ctx, { 
        type: 'line',
        data: {
            labels: dates,
            datasets: [{
                label: 'Nombre cumulé de vaccinés ',
                data: nb_vaccines,
                borderWidth: 3,
                backgroundColor: 'rgba(0, 168, 235, 0.5)',
                borderColor: 'rgba(0, 168, 235, 1)',
                cubicInterpolationMode: 'monotone'
            },
            ]
        },
        options: {
            legend: {
                display: true
            },
            scales: {
                yAxes: [{
                    gridLines: {
                        display: false
                     },
                    ticks: {
                        min: 0
                    },
                    
                }],
                xAxes: [{
                    gridLines: {
                        display: false
                     },
                     ticks: {
                        maxRotation: 0,
                        minRotation: 0,
                        maxTicksLimit: 6,
                        callback: function(value, index, values) {
                        return value.slice(8) + "/" + value.slice(5, 7);
                     }
                     }

                }]
            },
            annotation: {
            events: ["click"],
            annotations: [
            
            ]
        }
        }
    });
}

tableVaccin();
function tableVaccin(){
    const table = document.getElementById("tableauVaccin");
    var first_red = true;
    for(i=0; i<10; i++){
        html += "<tr>"
        let row = table.insertRow();

        for(j=0; j<10; j++){
            var newrow = row.insertCell(j)

            let caseNb = i*10+j+1

            if(caseNb <= dejaVaccines){
                newrow.classList.add("green");
                
                
            } else if(caseNb <= 60){
                newrow.classList.add("red");
                if(first_red){
                    newrow.classList.add("blink_me");
                    first_red = false;
                }
            } else {
                newrow.classList.add("grey");
            }
        }

    }
}

function majValeurs(){
    

    document.getElementById("nb_vaccines").innerHTML = dejaVaccinesNb;
    document.getElementById("nb_vaccines_24h").innerHTML = dejaVaccinesNb - nb_vaccines[nb_vaccines.length-2];
    document.getElementById("proportionVaccines").innerHTML = (Math.round(dejaVaccines*10000000)/10000000).toFixed(4);
    document.getElementById("proportionVaccinesBox").innerHTML = (Math.round(dejaVaccines*10000000)/10000000).toFixed(4);
    document.getElementById("proportionAVaccinerImmu").innerHTML = (Math.round(restantaVaccinerImmunite*10000000)/10000000).toFixed(4);
    document.getElementById("objectif_quotidien").innerHTML = numberWithSpaces(objectifQuotidien);
    document.getElementById("date_projetee_objectif").innerHTML = formaterDate(dateProjetéeObjectif);
    date = dates[dates.length-1]
    date = date.slice(8) + "/" + date.slice(5, 7)
    heure = heures[heures.length-1]
    document.getElementById("date_maj_1").innerHTML = date + " à " + heure;
    document.getElementById("date_maj_2").innerHTML = date + " à " + heure;
    document.getElementById("date_maj_3").innerHTML = date + " à " + heure;

}
    
</script>

<!-- /wp:html -->

<div class="wp-block-button is-style-outline"><a class="wp-block-button__link" href="https://lydia-app.com/collect/covidtracker/fr" target="_blank" rel="noreferrer noopener">☕️ Offrez-moi un café</a></div>

<!-- wp:spacer -->
<div style="height:50px" aria-hidden="true" class="wp-block-spacer"></div>
<!-- /wp:spacer -->
